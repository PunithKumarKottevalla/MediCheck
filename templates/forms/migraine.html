<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Migraine Prediction</title>
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='cssFiles/Migrane_form.css') }}">
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="sticky-nav">
        <a href="#" class="logo"><i class='bx bx-heart'></i>Health & Lifestyle</a>
        <ul class="nav-links">
            <li><a href="{{ url_for('index') }}">Home</a></li>
            <li><a href="#survey" style="color:#6ce6dd;">Migraine</a></li>
            <li><a href="{{ url_for('userfeedback') }}">Feedback</a></li>
            <li><a href="{{ url_for('About_migraint') }}">About</a></li>
            <li><a href="{{ url_for('contact_obesity') }}">Contact</a></li>
        </ul>

        <!-- Profile Dropdown -->
        <div class="profile-container">
            <button class="profile-btn" id="profileToggle">
                {% if user.photo_id %}
                    <img src="{{ url_for('get_photo', photo_id=user.photo_id) }}" alt="Profile" class="profile-img">
                {% else %}
                    <div class="profile-icon">{{ user.name[0] | upper}}</div>
                {% endif %}
            </button>
            <div class="dropdown-content" id="dropdownContent">
                <ul>
                    <li><i class='bx bx-user'></i> {{ user.name }}</li>
                    <li><i class='bx bx-envelope'></i> {{ user.email }}</li>
                    <li><a href="{{ url_for('profile') }}"><i class='bx bx-cog'></i> Edit Profile</a></li>
                    <li class="dropdown-divider"></li>
                    <li><a href="{{ url_for('back_to_login') }}"><i class='bx bx-log-out'></i> Log Out</a></li>
                    <li><a href="{{ url_for('logout') }}" class="delete-account"><i class='bx bx-trash'></i> Delete Account</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Migraine Form Container -->
    <div class="form-container">
        <h1>Migraine Prediction Form</h1>
        <form id="migraineForm">
            <!-- Personal Information -->
            <div class="form-section">
                <label for="age">Age:</label>
                <input type="number" id="age" name="age" placeholder="Enter your age" required>
                
                <label for="frequency">Headache Frequency (Daily):</label>
                <input type="number" id="frequency" name="frequency" min="1" max="8" placeholder="1-8 times" required>
            </div>

            <!-- Symptoms Section -->
            <div class="form-section">
                <div class="radio-group">
                    <label>Vomiting Sensation:</label>
                    <div class="radio-options">
                        <label><input type="radio" name="vomit_sensation" value="Yes" required> Yes</label>
                        <label><input type="radio" name="vomit_sensation" value="No" required> No</label>
                    </div>
                </div>

                <!-- Repeat similar structure for other symptoms -->
                <div class="radio-group">
                    <label>Sensitivity to Sound:</label>
                    <div class="radio-options">
                        <label><input type="radio" name="sound_sensitivity" value="Yes" required> Yes</label>
                        <label><input type="radio" name="sound_sensitivity" value="No" required> No</label>
                    </div>
                </div>

                <div class="radio-group">
                    <label>Sensitivity to Light:</label>
                    <div class="radio-options">
                        <label><input type="radio" name="light_sensitivity" value="Yes" required> Yes</label>
                        <label><input type="radio" name="light_sensitivity" value="No" required> No</label>
                    </div>
                </div>
            </div>

            <!-- Additional Information -->
            <div class="form-section">
                <label for="medication">Current Medication:</label>
                <input type="text" id="medication" name="medication" placeholder="Enter medications" required>

                <label for="notes">Additional Notes:</label>
                <textarea id="notes" name="notes" rows="4" placeholder="Describe your symptoms..."></textarea>
            </div>

            <input type="submit" value="Analyze" class="submit-btn">
        </form>
    </div>

    <!-- Response Container -->
    <div id="response" class="response-container">
        <div class="response-content"></div>
    </div>

    <!-- Footer -->
    <footer>
        <p>WE ARE TRYING TO GIVE 100% ACCURACY PREDICTION</p>
    </footer>

    <script>
        // Profile Dropdown Logic
        const profileToggle = document.getElementById('profileToggle');
        const dropdownContent = document.getElementById('dropdownContent');
        let dropdownTimeout;
    
        profileToggle.addEventListener('click', (e) => {
            e.stopPropagation();
            dropdownContent.classList.toggle('show');
        });
    
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.profile-container')) {
                dropdownContent.classList.remove('show');
            }
        });
    
        // Form Elements and Response Container
        const form = document.getElementById('migraineForm');
        const responseContainer = document.getElementById('response');
        const responseBox = document.querySelector('.response-content');
        const submitBtn = document.querySelector('.submit-btn');
    
        // Form Submission Handler
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            submitBtn.disabled = true;
            submitBtn.value = 'Analyzing...';
    
            const formData = {
                age: form.age.value,
                frequency: form.frequency.value,
                vomit_sensation: form.vomit_sensation.value,
                sound_sensitivity: form.sound_sensitivity.value,
                light_sensitivity: form.light_sensitivity.value,
                medication: form.medication.value,
                notes: form.notes.value
            };
    
            try {
                const response = await fetch('http://127.0.0.1:5000/give', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });
                
                const data = await response.json();
                responseBox.textContent = data.reply || data.error;
                responseContainer.classList.add('show');
                window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
            } catch (error) {
                responseBox.textContent = "Connection Error. Please try again.";
                responseContainer.classList.add('show');
            } finally {
                submitBtn.disabled = false;
                submitBtn.value = 'Analyze';
            }
        });
    
        // Hide results when inputs change
        document.querySelectorAll('#migraineForm input, #migraineForm select, #migraineForm textarea').forEach(element => {
            element.addEventListener('input', () => {
                if (responseContainer.classList.contains('show')) {
                    responseContainer.classList.remove('show');
                    responseBox.textContent = '';
                }
            });
        });
    
        // Additional listener for radio buttons (if needed)
        document.querySelectorAll('#migraineForm input[type="radio"]').forEach(radio => {
            radio.addEventListener('change', () => {
                if (responseContainer.classList.contains('show')) {
                    responseContainer.classList.remove('show');
                    responseBox.textContent = '';
                }
            });
        });
    </script>
</body>
</html>